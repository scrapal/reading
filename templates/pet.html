{% extends 'base.html' %}
{% block title %}å® ç‰©å°å±‹ Â· é˜…è¯»ç©ºé—´{% endblock %}
{% block content %}
  <section class="card pet-card">
    <div class="section-header">
      <div>
        <h2>{{ pet.name }}</h2>
        <p>ä½¿ç”¨é‡‘å¸æ¥å–‚å…»/ç…§é¡¾å® ç‰©ï¼Œä¿æŒé¥±è…¹ä¸å¿«ä¹ã€‚</p>
        {% if pet_appearance.mood == 'hungry' %}
          <p style="color: #fa5252; font-weight: 600;">âš ï¸ {{ pet.name }}é¥¿äº†ï¼Œå¿«å–‚ç‚¹ä¸œè¥¿å§ï¼</p>
        {% elif pet_appearance.mood == 'sad' %}
          <p style="color: #868e96; font-weight: 600;">ğŸ˜¢ {{ pet.name }}æœ‰ç‚¹ä¸å¼€å¿ƒï¼Œå¤šé™ªé™ªå®ƒå§ï¼</p>
        {% endif %}
      </div>
      <div class="coin-balance">å½“å‰é‡‘å¸ï¼š<strong>{{ coins }}</strong></div>
    </div>
    <div class="pet-stats">
      <div class="stat">
        <span>é¥±é£Ÿåº¦ï¼ˆè¶Šé«˜è¶Šå¥½ï¼‰</span>
        <strong>{{ satiety }}/100</strong>
      </div>
      <div class="stat">
        <span>å¿«ä¹å€¼</span>
        <strong>{{ pet.happiness }}/100</strong>
      </div>
      <div class="stat">
        <span>æœ€è¿‘ç…§é¡¾æ—¶é—´</span>
        <strong>{{ pet.last_care_at|friendly_date }}</strong>
      </div>
    </div>
    <div class="pet-playground">
      <div class="pet-field">
        <div class="pet-path"></div>
        <div class="pet-character" style="border-color: {{ pet_appearance.color }};">
          <div class="pet-svg-display" style="color: {{ pet_appearance.color }};">{{ pet_appearance.svg|safe }}</div>
        </div>
        <div class="pet-sparkle sparkle-1"></div>
        <div class="pet-sparkle sparkle-2"></div>
        {% for toy in owned_toys %}
          <div class="pet-toy" style="left: {{ toy.pos_x }}%; top: {{ toy.pos_y }}%;">
            <span class="toy-icon">{{ toy.icon }}</span>
          </div>
        {% endfor %}
      </div>
      <p class="note">{{ pet.name }}åœ¨è‰åªä¸Šæ•£æ­¥ï¼Œä¿æŒå¥½å¿ƒæƒ…å§ï¼</p>
    </div>
  </section>

  <section class="card">
    <div class="section-header">
      <h3>ç©å…·å•†åº—</h3>
    </div>
    <div class="toy-shop">
      {% for toy in toy_catalog %}
        <form class="toy-card" method="post" action="{{ url_for('pet_buy_toy', slug=toy.slug) }}">
          <div class="toy-icon large">{{ toy.icon }}</div>
          <div>
            <h4>{{ toy.name }}</h4>
            <p>{{ toy.description }}</p>
            <small>å·²æ‹¥æœ‰ï¼š{{ toy.owned }}</small>
          </div>
          <button class="btn" type="submit" {% if coins < toy.price %}disabled{% endif %}>
            {{ toy.price }} é‡‘å¸
          </button>
        </form>
      {% else %}
        <p>æš‚æ— ç©å…·å¯è´­ä¹°ã€‚</p>
      {% endfor %}
    </div>
  </section>

  <section class="card">
    <div class="section-header">
      <h3>äº’åŠ¨é¡¹ç›®</h3>
    </div>
    <form class="pet-actions" method="post">
      {% for key, action in actions.items() %}
        <button class="action-tile" name="action" value="{{ key }}" type="submit">
          <div>
            <h4>{{ action.label }}</h4>
            <p>{{ action.description }}</p>
          </div>
          <div class="action-meta">
            <span class="badge">è€—è´¹ {{ action.cost }} é‡‘å¸</span>
            <small>é¥±é£Ÿåº¦ {{ '%+d' % (-action.hunger_delta) }}, å¿«ä¹ {{ '%+d' % action.happiness_delta }}</small>
          </div>
        </button>
      {% endfor %}
    </form>
    <p class="note">æ¸©é¦¨æç¤ºï¼šé‡‘å¸ä¸è¶³æ—¶æ— æ³•è¿›è¡Œäº’åŠ¨ï¼Œè¯·å…ˆå®Œæˆæ¯æ—¥ä»»åŠ¡ã€‚</p>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const field = document.querySelector('.pet-field');
      const pet = document.querySelector('.pet-character');
      if (!field || !pet) return;

      const movePet = () => {
        const fieldRect = field.getBoundingClientRect();
        const petRect = pet.getBoundingClientRect();
        const sidePadding = 25;
        const groundOffset = 40;
        const xRange = Math.max(fieldRect.width - petRect.width - sidePadding * 2, 10);
        const yBaseline = fieldRect.height - petRect.height - groundOffset;
        const x = Math.random() * xRange + sidePadding;
        const y = yBaseline + (Math.random() * 10 - 5); // è½»å¾®ä¸Šä¸‹æµ®åŠ¨
        pet.style.transform = `translate(${x}px, ${y}px)`;
      };

      movePet();
      setInterval(movePet, 5500);
    });
  </script>
{% endblock %}
