{% extends 'base.html' %}
{% block title %}验证码兑换 · 阅读空间{% endblock %}
{% block content %}
  <section class="card">
    <div class="section-header">
      <div>
        <h2>验证码兑换</h2>
      </div>
      <div class="coin-balance">当前金币：<strong>{{ user.coins }}</strong></div>
    </div>

    {% if is_boarder %}
      <div style="background: #d3f9d8; border: 1px solid #8ce99a; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
        <strong style="color: #0ca678;">✅ 已激活</strong>
        <p style="margin: 0.5rem 0 0; color: #495057;">
          有效期至：{{ boarder_until|friendly_date }}
        </p>
      </div>
    {% else %}
      <div style="background: #fff3bf; border: 1px solid #fab005; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
        <strong style="color: #b35c00;">⚠️ 未激活</strong>
      </div>
    {% endif %}
  </section>

  <section class="card form-card">
    <h3>请输入兑换验证码</h3>
    <form method="post">
      <label>验证码
        <input type="text" name="code" placeholder="ABC12345" maxlength="8" required style="text-transform: uppercase; font-family: monospace; font-size: 1.2rem; letter-spacing: 0.1em;">
      </label>
      <button class="btn" type="submit">兑换</button>
    </form>
  </section>

  {% if redemption_history %}
    <section class="card">
      <h3>我的兑换记录</h3>
      <ul class="discussion-list">
        {% for record in redemption_history %}
          <li class="discussion-item">
            <div class="avatar" style="background: #d3f9d8; color: #0ca678; font-weight: bold;">✓</div>
            <div style="flex: 1;">
              <p class="comment-text">
                <strong style="font-family: monospace;">{{ record.code }}</strong>
              </p>
              <div class="comment-meta">
                <span>获得 {{ record.coins_reward }} 金币</span>
                <span>兑换于 {{ record.used_at|friendly_date }}</span>
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}
{% endblock %}
