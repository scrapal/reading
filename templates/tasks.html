{% extends 'base.html' %}
{% block title %}ä»»åŠ¡ä¸­å¿ƒ Â· é˜…è¯»ç©ºé—´{% endblock %}
{% block content %}
  {% if user and current_user %}
  <section class="card streak-card">
    <div style="text-align: center;">
      <div class="streak-display">
        <span class="streak-icon">ğŸ”¥</span>
        <div class="streak-info">
          <div class="streak-number">{{ current_user.streak_count or 0 }}</div>
          <div class="streak-label">è¿ç»­æ‰“å¡å¤©æ•°</div>
        </div>
      </div>
      <p class="streak-description">
        æ¯å¤©å®Œæˆ"è¯»ä¹¦æ‰“å¡"ä»»åŠ¡ç«è‹— +1ï¼Œæ–­ç­¾å½’é›¶ã€‚
        {% if is_current_boarder %}ä½å®¿ç”Ÿå…‘æ¢éªŒè¯ç å¯è·å¾— +5 ç«è‹—ï¼Œå·¥ä½œæ—¥ï¼ˆå‘¨ä¸€è‡³å‘¨äº”ï¼‰ä¸ä¼šå› æœªæ‰“å¡è€Œæ–­ç­¾ã€‚{% endif %}
      </p>
    </div>
  </section>
  {% endif %}

  <section class="card">
    <div class="section-header">
      <div>
        <h2>æ¯æ—¥ä»»åŠ¡</h2>
        <p>å®Œæˆä¸‹åˆ—ä»»åŠ¡å¯è·å¾—é‡‘å¸ï¼Œç”¨äºåœ¨å® ç‰©é¡µé¢è´­ä¹°äº’åŠ¨é¡¹ç›®ã€‚</p>
      </div>
      <a class="btn secondary" href="{{ url_for('pet') }}">æˆ‘çš„å® ç‰©</a>
    </div>
    <p class="note">æç¤ºï¼šåœ¨ä»»æ„ä¹¦ç±é¡µé¢é€‰æ‹©â€œè®¨è®ºâ€å‘è¡¨å³å¯å®Œæˆè®¨è®ºä»»åŠ¡ï¼›é€‰æ‹©â€œè¯»åæ„Ÿâ€å¹¶å†™æ»¡ 50 å­—å³å¯å®Œæˆè¯»åæ„Ÿä»»åŠ¡ï¼Œä¸èƒ½åœ¨æ­¤ç›´æ¥é¢†å–ã€‚</p>
    {% if not user %}
      <p>è¯·å…ˆ <a href="{{ url_for('login') }}">ç™»å½•</a> åå†å®Œæˆä»»åŠ¡ã€‚</p>
    {% endif %}
    <ul class="task-list">
      {% for row in task_rows %}
        <li class="task-item {% if row.completed %}done{% endif %}">
          <div>
            <h3>{{ row.task.name }}</h3>
            <p>{{ row.task.description }}</p>
          </div>
          <div class="task-meta">
            <span class="badge">+{{ row.task.coins_reward }} é‡‘å¸</span>
            {% if row.completed %}
              <span class="status">ä»Šæ—¥å·²å®Œæˆ</span>
            {% elif row.task.code in ['write_reflection', 'share_comment'] %}
              <span class="status pending">å‰å¾€ä¹¦é¡µå®Œæˆå¯¹åº”æ“ä½œ</span>
            {% elif user %}
              <form method="post" action="{{ url_for('complete_task', task_id=row.task.id) }}">
                <button class="btn" type="submit">ç«‹å³å®Œæˆ</button>
              </form>
            {% else %}
              <span class="status pending">ç™»å½•åå¯å®Œæˆ</span>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
  </section>
{% endblock %}
